!function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(a,o,function(e){return t[e]}.bind(null,o));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=443)}({443:function(t,e,n){t.exports=n(591)},591:function(t,e,n){"use strict";n.r(e);var a=function(t,e){t||(t=0);var n=parseInt(t)/100,a=2;t%100==0&&0==e.decimal_points&&(a=0);var o=",",r=".";"dot_comma"!=e.currency_separator&&(o=".",r=",");var i,c,f,s,u,l,p,m,d,_,h=e.currency_sign||"",y=(i=n,c=a,f=r,s=o,u=isNaN(c)?2:Math.abs(c),l=f||".",p=void 0===s?",":s,m=i<0?"-":"",d=parseInt(i=Math.abs(i).toFixed(u))+"",_=(_=d.length)>3?_%3:0,m+(_?d.substr(0,_)+p:"")+d.substr(_).replace(/(\d{3})(?=\d)/g,"$1"+p)+(u?l+Math.abs(i-d).toFixed(u).slice(2):""));return"right"==e.currency_sign_position?y+""+h:"left_space"==e.currency_sign_position?h+" "+y:"right_space"==e.currency_sign_position?y+" "+h:h+""+y};n(613);function o(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.attr("data-form_id");this.$form=e,this.formId=n,this.paymentMethod="",this.paymentConfig=window.fluentform_payment_config,this.appliedCoupons={},this.totalAmount=0,this.formPaymentConfig=window["fluentform_payment_config_"+n]}var e,n,r;return e=t,(n=[{key:"$t",value:function(t){return this.paymentConfig.i18n[t]?this.paymentConfig.i18n[t]:t}},{key:"init",value:function(){var t=this;this.$form.on("fluentform_next_action_payment",(function(e,n){var a=n.response.data;a.actionName&&(jQuery("<div/>",{id:"form_success",class:"ff-message-success"}).html(a.message).insertAfter(t.$form),t[a.actionName](a))})),jQuery(".ff_modal_btn").on("click",(function(){t.calculatePayments()})),this.calculatePayments(),this.$form.find(".ff_payment_item,.ff_quantity_item").on("change",(function(){t.calculatePayments()})),this.$form.on("do_calculation",(function(){t.calculatePayments()})),this.initDiscountCode()}},{key:"calculatePayments",value:function(){var t=this,e=this.$form,n=this.getPaymentItems(),a=0;jQuery.each(n,(function(t,e){a+=e.line_total})),this.totalAmount=a;var o=this.getDiscounts();jQuery.each(o,(function(e,n){var o=n.amount;"percent"==n.coupon_type&&(o=n.amount/100*a),t.totalAmount-=o})),e.trigger("payment_amount_change",{amount:a,items:n,discounts:o}),e.find(".ff_order_total").html(this.getFormattedPrice(this.totalAmount)),e.data("payment_total",this.totalAmount),e.find(".ff_dynamic_payment_summary").length&&this.generateSummaryTable(n,a,o)}},{key:"generateSummaryTable",value:function(t,e,n){var a=this;if(this.$form.find(".ff_dynamic_payment_summary .ff_payment_summary_fallback").hide(),!e)return this.$form.find(".ff_dynamic_payment_summary .ff_payment_summary").html(""),void this.$form.find(".ff_dynamic_payment_summary .ff_payment_summary_fallback").show();var o='<table class="table ffp_table input_items_table">';o+="<thead><tr><th>".concat(this.$t("item"),"</th><th>").concat(this.$t("price"),"</th><th>").concat(this.$t("qty"),"</th><th>").concat(this.$t("line_total"),"</th></tr></thead>"),o+="<tbody>",jQuery.each(t,(function(t,e){e.price&&(o+="<tr>",o+="<td>".concat(e.label,"</td>"),o+="<td>".concat(a.getFormattedPrice(e.price),"</td>"),o+="<td>".concat(e.quantity,"</td>"),o+="<td>".concat(a.getFormattedPrice(e.line_total),"</td>"),o+="</tr>")})),o+="</tbody>";var r="";n.length&&(r+='<tr><th class="item_right" colspan="3">'.concat(this.$t("Sub Total"),"</th><th>").concat(this.getFormattedPrice(e),"</th></tr>"),jQuery.each(n,(function(t,n){var o=n.amount;"percent"==n.coupon_type&&(o=n.amount/100*e),r+='<tr><th class="item_right" colspan="3">'.concat(a.$t("discount:")," ").concat(n.title,"</th><th>-").concat(a.getFormattedPrice(o),"</th></tr>"),e-=o}))),r+='<tr><th class="item_right" colspan="3">'.concat(this.$t("total"),"</th><th>").concat(this.getFormattedPrice(e),"</th></tr>"),o+="<tfoot>".concat(r,"</tfoot>"),o+="</table>",this.$form.find(".ff_dynamic_payment_summary .ff_payment_summary").html(o)}},{key:"getPaymentItems",value:function(){var t=this.$form,e=t.find(".ff-el-group:not(.ff_excluded)").find(".ff_payment_item"),n={},a=this;function o(t,e,o){t=t.replace("[","").replace("]","");var r=a.getQuantity(t);r&&(n[t]={label:e,price:o,quantity:r,line_total:r*o})}return e.each((function(e,n){var a=n.type,r=jQuery(n);if(!r.closest(".has-conditions.ff_excluded").length){var i=r.attr("name"),c=r.closest(".ff-el-group").find(".ff-el-input--label label").text();if("radio"==a){var f=t.find("input[name="+i+"]:checked"),s=f.attr("data-payment_value");s&&o(i,c+=" - "+f.parent().find("span").text(),parseFloat(s))}else if("hidden"==a){var u=r.attr("data-payment_value");u&&o(i,c,parseFloat(u))}else if("number"==a||"text"==a){var l=window.ff_helper.numericVal(jQuery(this));l&&o(i,c,parseFloat(l))}else if("checkbox"==a){var p=r.data("group_id"),m=t.find('input[data-group_id="'+p+'"]:checked'),d=0,_=[];m.each((function(t,e){var n=jQuery(e).data("payment_value");n&&(d+=parseFloat(n),_.push(jQuery(e).parent().find("span").text()))})),_.length&&(c+=' <ul class="ff_sub_items">',_.forEach((function(t){c+="<li>"+t+"</li>"})),c+=" </ul>"),d&&o(i,c,d)}else if("select-one"==a){var h=t.find("select[name="+i+"] option:selected"),y=h.data("payment_value");y&&o(i,c+=" - "+h.text(),parseFloat(y))}}})),n}},{key:"getQuantity",value:function(t){var e=this.$form.find('input[data-target_product="'+t+'"]');if(!e.length)return 1;var n=e.val();return!n||isNaN(n)?0:parseInt(n)}},{key:"getFormattedPrice",value:function(t){return a(parseInt(100*t),window["fluentform_payment_config_"+this.formId].currency_settings)}},{key:"stripeRedirectToCheckout",value:function(t){new Stripe(this.formPaymentConfig.stripe.publishable_key).redirectToCheckout({sessionId:t.sessionId}).then((function(t){console.log(t)}))}},{key:"normalRedirect",value:function(t){window.location.href=t.redirect_url,console.log(t)}},{key:"getDiscounts",value:function(){return Object.values(this.appliedCoupons)}},{key:"initDiscountCode",value:function(){var t=this,e=this.$form.find(".ff_coupon_wrapper");if(!e.length)return!1;this.$form.append('<input type="hidden" class="__ff_all_applied_coupons" name="__ff_all_applied_coupons"/>'),jQuery.each(e,(function(e,n){var a=jQuery(n);a.find(".ff_input-group-append").on("click",(function(){var e=a.find("input.ff_coupon_item"),n=e.val();if(!n)return"";e.attr("disabled",!0),e.attr("name"),jQuery.post(window.fluentFormVars.ajaxUrl,{action:"fluentform_apply_coupon",form_id:t.formId,total_amount:t.totalAmount,coupon:n,other_coupons:t.$form.find(".__ff_all_applied_coupons").val()}).then((function(o){var r=o.coupon;t.appliedCoupons[r.code]=r,t.$form.find(".__ff_all_applied_coupons").attr("value",JSON.stringify(Object.keys(t.appliedCoupons)));var i=r.amount+"%";"fixed"==r.type&&(i=t.getFormattedPrice(r.amount));var c="".concat(r.code," <span>-").concat(i,"</span>");t.recordCouponMessage(a,n,c,"success"),e.val("")})).fail((function(e){t.recordCouponMessage(a,n,e.responseJSON.message,"error")})).always((function(){e.attr("disabled",!1),t.$form.trigger("do_calculation")}))}))}))}},{key:"recordCouponMessage",value:function(t,e,n,a){var o=this;t.find(".ff_coupon_responses").length||t.append('<ul class="ff_coupon_responses"></ul>');var r=t.find(".ff_coupon_responses");r.find(".ff_error, .ff_resp_item_"+e).remove();var i=jQuery("<li/>",{class:"ff_".concat(a," ff_resp_item_").concat(e)}),c=jQuery("<span/>",{class:"error-clear",html:"&times;",click:function(t){r.find(".ff_resp_item_"+e).remove(),delete o.appliedCoupons[e],o.$form.find(".__ff_all_applied_coupons").attr("value",JSON.stringify(Object.keys(o.appliedCoupons))),o.$form.trigger("do_calculation")}});r.append(i.append(c,n))}}])&&o(e.prototype,n),r&&o(e,r),t}();jQuery(document).ready((function(t){t.each(t("form.fluentform_has_payment"),(function(){new r(t(this)).init()}))}))},613:function(t,e){}});